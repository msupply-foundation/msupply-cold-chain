{"version":3,"sources":["DevBleManager.ts"],"names":["COMMAND_TO_RESULT_LOOKUP","callback","value","KmJsaW5r","KmJk","DevBleManager","constructor","LogLevel","None","connectedDevices","registeredCallbacks","isScanning","scannerInterval","logLevel","level","cancelTransaction","transactionId","console","log","setLogLevel","connectToDevice","macAddress","id","name","isDeviceConnected","cancelDeviceConnection","device","Error","discoverAllServicesAndCharacteristicsForDevice","connectedDevice","stopDeviceScan","clearInterval","startDeviceScan","_","__","setInterval","manufacturerData","writeCharacteristicWithoutResponseForDevice","command","___","monitorCharacteristicForDevice"],"mappings":"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","sourcesContent":["import { MacAddress } from '../types/common';\nimport { BluetoothManager, MockOrRealDevice } from './BleManager';\nimport {\n  Device,\n  BleError,\n  ScanOptions,\n  Characteristic,\n  Subscription,\n  LogLevel,\n} from 'react-native-ble-plx';\n\ninterface MonitorCallback {\n  (error: BleError | null, characteristic: Characteristic | null): void;\n}\n\nconst COMMAND_TO_RESULT_LOOKUP = {\n  // *logall\n  'KmxvZ2FsbA==': (callback: MonitorCallback) => {\n    callback(null, { value: 'ABEAEQARAAIBAAAAAAA6' } as Characteristic); // 00110011001100020100000000003ax\n    callback(null, { value: 'ARcBFwEXARcBFwEXARcBFwEXARc=' } as Characteristic); // 0117011701170117011701170117011701170117x\n    callback(null, { value: 'ARcBFwEXARYBFgEWARguAAAAAAA=' } as Characteristic); // 01170117011701160116011601182e0000000000x\n    callback(null, null);\n  },\n  // *blink\n  KmJsaW5r: (callback: MonitorCallback) => {\n    callback(null, { value: 'T2sA' } as Characteristic);\n    callback(null, null);\n  },\n  // *info\n  'KmluZm8=': (callback: MonitorCallback) => {\n    callback(null, { value: 'U0VUVElOR1MAAAAAAAAAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'TmFtZTogICBFNzIyOTZERQAAAAA=' } as Characteristic);\n    callback(null, { value: 'VmVyIG5vOiAxMwAAAAAAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'U3ViIHZlciBubzogMTUuMC4wAAA=' } as Characteristic);\n    callback(null, { value: 'UmVsIGR0ZTogMjYgU2VwIDE5AAA=' } as Characteristic);\n    callback(null, { value: 'VHhwIGx2bDogNAAAAAAAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'QmF0dCBsdmw6IDEwMCUAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'TWVtIDgzMyBkYXlzAAAAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'QWR2IHdrZXVwOiBOL0EAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'VW5pdHM6IEMAAAAAAAAAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'TWVtOiAyMDAwMAAAAAAAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'QWlyIG1vZGUgb2ZmAAAAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'UnVuIGFwcHggMTZocnMAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'RGF0ZSB5eW1tZGRoaG1tOgAAAAA=' } as Characteristic);\n    callback(null, { value: 'LT4gMDA6MDA6MDA6MDA6MDAAAAA=' } as Characteristic);\n    callback(null, { value: 'SWQ6IDI1NQAAAAAAAAAAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'QnRuIG9uL29mZjogMQAAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'VGVtcCBDYWwuIDAAAAAAAAAAAAA=' } as Characteristic);\n    callback(null, { value: 'SHVtIENhbHgxMCAwJQAAAAAAAAA=' } as Characteristic);\n    callback(null, null);\n  },\n  // *bd\n  KmJk: (callback: MonitorCallback) => {\n    callback(null, { value: 'T2sA' } as Characteristic);\n    callback(null, null);\n  },\n  // *lint300\n  'KmxpbnQzMDA=': (callback: MonitorCallback) => {\n    callback(null, { value: 'SW50ZXJ2YWw6IDYwcwAAAAAAAAA=' } as Characteristic);\n    callback(null, null);\n  },\n};\n\nexport class DevBleManager implements BluetoothManager {\n  connectedDevices: { [key: string]: MockOrRealDevice | null };\n\n  registeredCallbacks: {\n    [key: string]: MonitorCallback;\n  };\n\n  isScanning: boolean;\n\n  level: LogLevel = LogLevel.None;\n\n  scannerInterval: number | null;\n\n  constructor() {\n    this.connectedDevices = {};\n    this.registeredCallbacks = {};\n    this.isScanning = false;\n    this.scannerInterval = null;\n  }\n  async logLevel(): Promise<LogLevel> {\n    return this.level;\n  }\n\n  cancelTransaction(transactionId: string): void {\n    console.log(`Canceling transaction ${transactionId}`);\n  }\n\n  setLogLevel(logLevel: LogLevel): void {\n    this.level = logLevel;\n  }\n\n  async connectToDevice(macAddress: MacAddress): Promise<MockOrRealDevice> {\n    this.connectedDevices[macAddress] = { id: macAddress, name: 'bluemaestro' };\n    if (this.level !== LogLevel.None) {\n      console.log('connect to Device in DEVBlemanager');\n    }\n    return { id: macAddress, name: 'bluemaestro' };\n  }\n\n  async isDeviceConnected(macAddress: string): Promise<boolean> {\n    return !!this.connectedDevices[macAddress];\n  }\n\n  async cancelDeviceConnection(macAddress: string): Promise<MockOrRealDevice> {\n    const device = this.connectedDevices[macAddress];\n\n    if (!device) {\n      throw new Error('Device is not connected');\n    }\n\n    this.connectedDevices[macAddress] = null;\n\n    return device;\n  }\n\n  async discoverAllServicesAndCharacteristicsForDevice(\n    macAddress: MacAddress\n  ): Promise<MockOrRealDevice> {\n    const connectedDevice = this.connectedDevices[macAddress];\n    if (this.level !== LogLevel.None) {\n      console.log('connect to Device in DEVBlemanager');\n    }\n    if (!connectedDevice) {\n      throw new Error(\"Trying to discover services of a device which isn't connected\");\n    }\n\n    return connectedDevice;\n  }\n\n  stopDeviceScan(): void {\n    this.isScanning = false;\n\n    if (this.scannerInterval) clearInterval(this.scannerInterval);\n  }\n\n  startDeviceScan(\n    _: string[] | null,\n    __: ScanOptions | null,\n    callback: (error: BleError | null, scannedDevice: Device | null) => void\n  ): void {\n    this.isScanning = true;\n    if (this.level !== LogLevel.None) {\n      console.log('Scanning in DEVBlemanager');\n    }\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore - TSC sometimes thinks it's getting setInterval from node, not react-native\n    this.scannerInterval = setInterval(\n      () =>\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore - Ignoring this as I don't want to create a full Device object for this development helper.\n        callback(null, {\n          id: 'AB:CD:EF:GH:IJ:KL',\n          manufacturerData: 'MwEBDAN0AFkBtwEMA3QAWQG3AMwCrAAAAAAA',\n        }),\n      1000\n    );\n  }\n\n  async writeCharacteristicWithoutResponseForDevice(\n    macAddress: string,\n    _: string,\n    __: string,\n    command: string,\n    ___: string\n  ): Promise<Characteristic> {\n    const connectedDevice = this.connectedDevices[macAddress];\n    const callback = this.connectedDevices[macAddress];\n    if (connectedDevice && callback) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore - ignoring this to not explicitly type the base64d commands etc\n      COMMAND_TO_RESULT_LOOKUP[command](callback);\n      this.connectedDevices[macAddress] = null;\n    } else {\n      throw new Error(\"Trying to write to a device which isn't connected or isn't being monitored\");\n    }\n\n    return {} as Characteristic;\n  }\n\n  monitorCharacteristicForDevice(\n    macAddress: string,\n    _: string,\n    __: string,\n    callback: MonitorCallback,\n\n    ___: string\n  ): Subscription {\n    const connectedDevice = this.connectedDevices[macAddress];\n    if (connectedDevice) {\n      this.registeredCallbacks[macAddress] = callback;\n    } else {\n      throw new Error(\"Trying to write to a device which isn't connected\");\n    }\n\n    return {} as Subscription;\n  }\n}\n"]}